<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Project 3: Bike Sharing Prediction | Main Page</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="In this assignment from the Statistical Programming in Python course I predicted the total number of Washington D.C. bicycle users on an hourly basis using a dataset (&ldquo;hour.csv&rdquo;) with data from 2011 and 2012.
Part 1: Exploratory Data Analysis 1.1. Ensuring data quality
1.2. Plotting clear and meaningful figures
1.3. Checking possibly redundant variables via correlations
1.4. Giving insights on what seems relevant for prediction and what does not
Part 2: Data Engineering 2.">
    <meta name="generator" content="Hugo 0.83.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    

  
  
    <link rel="stylesheet" href="https://pedrolousantos.github.io/Pedro_Portfolio/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css" >
  




    
      

    

    
    
    <meta property="og:title" content="Project 3: Bike Sharing Prediction" />
<meta property="og:description" content="In this assignment from the Statistical Programming in Python course I predicted the total number of Washington D.C. bicycle users on an hourly basis using a dataset (&ldquo;hour.csv&rdquo;) with data from 2011 and 2012.
Part 1: Exploratory Data Analysis 1.1. Ensuring data quality
1.2. Plotting clear and meaningful figures
1.3. Checking possibly redundant variables via correlations
1.4. Giving insights on what seems relevant for prediction and what does not
Part 2: Data Engineering 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pedrolousantos.github.io/Pedro_Portfolio/post/project-3/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-03-06T11:13:32-04:00" />
<meta property="article:modified_time" content="2021-03-06T11:13:32-04:00" />

<meta itemprop="name" content="Project 3: Bike Sharing Prediction">
<meta itemprop="description" content="In this assignment from the Statistical Programming in Python course I predicted the total number of Washington D.C. bicycle users on an hourly basis using a dataset (&ldquo;hour.csv&rdquo;) with data from 2011 and 2012.
Part 1: Exploratory Data Analysis 1.1. Ensuring data quality
1.2. Plotting clear and meaningful figures
1.3. Checking possibly redundant variables via correlations
1.4. Giving insights on what seems relevant for prediction and what does not
Part 2: Data Engineering 2."><meta itemprop="datePublished" content="2021-03-06T11:13:32-04:00" />
<meta itemprop="dateModified" content="2021-03-06T11:13:32-04:00" />
<meta itemprop="wordCount" content="3985">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Project 3: Bike Sharing Prediction"/>
<meta name="twitter:description" content="In this assignment from the Statistical Programming in Python course I predicted the total number of Washington D.C. bicycle users on an hourly basis using a dataset (&ldquo;hour.csv&rdquo;) with data from 2011 and 2012.
Part 1: Exploratory Data Analysis 1.1. Ensuring data quality
1.2. Plotting clear and meaningful figures
1.3. Checking possibly redundant variables via correlations
1.4. Giving insights on what seems relevant for prediction and what does not
Part 2: Data Engineering 2."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://pedrolousantos.github.io/Pedro_Portfolio/images/bike2.jfif');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://pedrolousantos.github.io/Pedro_Portfolio/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Main Page
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://pedrolousantos.github.io/Pedro_Portfolio/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://pedrolousantos.github.io/Pedro_Portfolio/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://pedrolousantos.github.io/Pedro_Portfolio/post/" title="Projects page">
              Projects
            </a>
          </li>
          
        </ul>
      
      







<a href="https://www.linkedin.com/in/pedrolousantos" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/pedrolousantos" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>








    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Project 3: Bike Sharing Prediction</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        PROJECTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://pedrolousantos.github.io/Pedro_Portfolio/post/project-3/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://pedrolousantos.github.io/Pedro_Portfolio/post/project-3/&amp;text=Project%203:%20Bike%20Sharing%20Prediction" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://pedrolousantos.github.io/Pedro_Portfolio/post/project-3/&amp;title=Project%203:%20Bike%20Sharing%20Prediction" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Project 3: Bike Sharing Prediction</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-03-06T11:13:32-04:00">March 6, 2021</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>In this assignment from the Statistical Programming in Python course I predicted the total number of Washington D.C. bicycle users on an hourly basis using a dataset (&ldquo;hour.csv&rdquo;) with data from 2011 and 2012.</p>
<h3 id="part-1-exploratory-data-analysis">Part 1: Exploratory Data Analysis</h3>
<p>1.1. Ensuring data quality</p>
<p>1.2. Plotting clear and meaningful figures</p>
<p>1.3. Checking possibly redundant variables via correlations</p>
<p>1.4. Giving insights on what seems relevant for prediction and what does not</p>
<h3 id="part-2-data-engineering">Part 2: Data Engineering</h3>
<p>2.1. Discussion on missing values and outliers</p>
<p>2.2. Treatment of text and date features</p>
<p>2.3. Generation of extra features and studying the influence of combinations of features</p>
<p>2.4. Giving new insights on what seems relevant for prediction and what does not</p>
<p>2.5. Use of scikit-learn pipelines to perform transformations</p>
<h3 id="part-3-machine-learning">Part 3: Machine Learning</h3>
<p>3.1. Choosing sensible models (linear and non-linear)</p>
<p>a) Baseline Linear Regression with Initial Variables</p>
<p>b) Linear Regression with New Variables</p>
<p>c) Baseline Random Forest</p>
<p>3.2. Tuning model parameters with validation</p>
<p>3.3. Obtaining accurate predictions in test</p>
<p>3.4. Plotting predictions vs reality for additional insights</p>
<h2 id="part-1-exploratory-data-analysis-1">Part 1: Exploratory Data Analysis</h2>
<p>We will first conduct the Exploratory Data Analysis or (EDA) to understand the dataset, by summarizing its main characteristics.</p>
<h4 id="loading-the-data-into-the-pandas-data-frame">Loading the data into the pandas data frame:</h4>
<p>The variable &ldquo;instant&rdquo; could be our index since since it is a good key column (identifying each observation with a different value for every row from 1 to 17379).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">df</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;hour.csv&#34;</span>,<span style="color:#a6e22e">index_col</span>=<span style="color:#e6db74">&#34;instant&#34;</span>,<span style="color:#a6e22e">parse_dates</span> = [<span style="color:#e6db74">&#34;dteday&#34;</span>])</code></pre></div>
<p><strong>Column Legend:</strong></p>
<ul>
<li><strong>instant:</strong> records index</li>
<li><strong>dteday:</strong> date</li>
<li><strong>hr:</strong> hour (0 to 23)</li>
<li><strong>weathersit:</strong> Weather situation</li>
<li><strong>temp:</strong> Normalized temperature in Celsius. The values are divided to 41 (max)</li>
<li><strong>atemp:</strong> Normalized feeling temperature in Celsius. The values are divided to 50 (max)</li>
<li><strong>hum:</strong> Normalized humidity. The values are divided to 100 (max)</li>
<li><strong>windspeed:</strong> Normalized wind speed. The values are divided to 67 (max)</li>
<li><strong>casual:</strong> count of casual users</li>
<li><strong>registered:</strong> count of registered users</li>
<li><strong>cnt:</strong> count of total rental bikes including both casual and registered</li>
</ul>
<h3 id="11-ensuring-data-quality">1.1. Ensuring data quality</h3>
<p>We will take a look of the first rows of our data, to see what it looks like by displaying the top 5 rows.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">head</span>(<span style="color:#ae81ff">5</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike3.JPG"/>
</figure>
</p>
<h3 id="12-plotting-clear-and-meaningful-figures">1.2. Plotting clear and meaningful figures</h3>
<p>We start this section by creating 3 lists to separate the numerical columns from the categorical colums:</p>
<ul>
<li>all_cols: all 11 columns [&lsquo;dteday&rsquo;,&lsquo;hr&rsquo;,&lsquo;weathersit&rsquo;,&lsquo;temp&rsquo;,&lsquo;atemp&rsquo;,&lsquo;hum&rsquo;,&lsquo;windspeed&rsquo;,&lsquo;casual&rsquo;,&lsquo;registered&rsquo;,&lsquo;cnt&rsquo;]</li>
<li>num_cols: 9 numeric columns [&lsquo;hr&rsquo;, &lsquo;temp&rsquo;, &lsquo;atemp&rsquo;, &lsquo;hum&rsquo;, &lsquo;windspeed&rsquo;, &lsquo;casual&rsquo;, &lsquo;registered&rsquo;, &lsquo;cnt&rsquo;]</li>
<li>cat_cols: 2 categorical columns [&lsquo;dteday&rsquo;, &lsquo;weathersit&rsquo;]</li>
</ul>
<p>These lists will be used in the Exploratory Data Analysis since distinct types of analyses are relevant for numerical and categorical variables.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">all_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">tolist</span>()
<span style="color:#a6e22e">num_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">include</span>=<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>).<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">to_list</span>()
<span style="color:#a6e22e">cat_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">exclude</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>).<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">to_list</span>()
<span style="color:#a6e22e">all_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">tolist</span>()
<span style="color:#a6e22e">num_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">include</span>=<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>).<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">to_list</span>()
<span style="color:#a6e22e">cat_cols</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">exclude</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>).<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">to_list</span>()</code></pre></div>
<p>A great way to have a better understanding of the data is by plotting it visually. We will use ipywidgets, also known as jupyter-widgets or simply widgets, which are interactive HTML widgets for Jupyter notebooks.</p>
<p>In the below distribution plot (histogram) we can iteratively select the numerical column we want to see the distribution.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">Column</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>), <span style="color:#a6e22e">bin</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">IntSlider</span>(<span style="color:#a6e22e">value</span> = <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">def</span> <span style="color:#a6e22e">plot_hist</span>(<span style="color:#a6e22e">Column</span>, <span style="color:#a6e22e">bin</span>):
  <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">distplot</span>(<span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column</span>], <span style="color:#a6e22e">kde</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">bins</span> = <span style="color:#a6e22e">bin</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column</span>].<span style="color:#a6e22e">value_counts</span>(<span style="color:#a6e22e">bins</span> = <span style="color:#a6e22e">bin</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike4.JPG"/>
</figure>
</p>
<h4 id="describing-the-distribution-of-the-numerical-columns">Describing the distribution of the numerical columns:</h4>
<p>Thanks to the &ldquo;ipw interact&rdquo; function, we can observe the distribution by variable on the same plot.</p>
<ul>
<li><strong>hr</strong>: ias expected the hour shows a uniform distribution.</li>
<li><strong>temp</strong>: most of our values are distributed around 0.2 and 0.8, having very little amount of data with very high or very low temperatures.</li>
<li><strong>windspeed</strong>: right skewed distribution with most of the values in between 0 and 0.3, which means we don&rsquo;t have much data with very high windspeed values.</li>
<li><strong>casual</strong>: right skewed distribution. Most of the values for casual users are in between 10 and 50. It is very unusual in our dataset to have more than 150 casual users per hour.</li>
<li><strong>registered</strong>: also right skewed distributed. Most of the values are in between 20 and 300 more or less. There might be a point that we have more than 800 registered users renting the bike per hour but that would be really rare.</li>
<li><strong>cnt</strong>: our target variable being calculated from the sum of the previous 2 variables is also right skewed distributed.</li>
</ul>
<p><strong>Categorical Columns Analysis</strong></p>
<p>In the below dropdown menu we can see the distribution of the categorical columns.</p>
<p><em><strong>dteday - Date column:</strong></em></p>
<ul>
<li>We see the maximum count is 24 (corresponding to the different 24h hours) for several days, meaning in that days bikes were used in every hour.</li>
<li>On 29/10/2012 only in 1 hour bikes were used (we checked it was at hour 0 - midnight). We found the below news which explains:</li>
</ul>
<p>29/10/2012 - 11:31 NEW YORK (Reuters) - Hurricane Sandy, the monster storm bearing down on the U.S. East Coast, strengthened on Monday after hundreds of thousands moved to higher ground, public transport shut down and the U.S. stock market suffered its first weather-related closure in 27 years.</p>
<p><em><strong>weathersit - Weather situation column:</strong></em></p>
<ul>
<li>4 different weather situation categories</li>
<li>66% of the hours the weather was &ldquo;Clear, Few clouds, Partly cloudy, Partly cloudy&rdquo;</li>
<li>26% of the hours the weather was &ldquo;Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist&rdquo;</li>
<li>So only around 8% of the hours the weather did not seem good for bike rides.</li>
</ul>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">Column</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">cat_cols</span>))
 <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">unique_count</span>(<span style="color:#a6e22e">Column</span>):
   <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column</span>].<span style="color:#a6e22e">value_counts</span>()
   <span style="color:#a6e22e">percent</span> = <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column</span>].<span style="color:#a6e22e">value_counts</span>(<span style="color:#a6e22e">normalize</span> = <span style="color:#a6e22e">True</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">2</span>)
   <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">percent</span>], <span style="color:#a6e22e">axis</span> = <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">keys</span>=[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Counts</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Percentage</span> (<span style="color:#f92672">%</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>])
 
</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike5.JPG"/>
</figure>
</p>
<h3 id="13-checking-possibly-redundant-variables-via-correlations">1.3. Checking possibly redundant variables via correlations</h3>
<p>Findind the pairwise correlation of all columns in the dataframe. Any na values are automatically excluded. Any non-numeric data type columns in the dataframe is ignored.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">figure</span>(<span style="color:#a6e22e">figsize</span>=(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">font_scale</span>=<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">set_style</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">white</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)

<span style="color:#a6e22e">corr</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">corr</span>()

<span style="color:#a6e22e">mask</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">triu</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">ones_like</span>(<span style="color:#a6e22e">corr</span>, <span style="color:#a6e22e">dtype</span>=<span style="color:#66d9ef">bool</span>)) <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Generating</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">mask</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">triangle</span>
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">heatmap</span>(<span style="color:#a6e22e">corr</span>, <span style="color:#a6e22e">cmap</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">coolwarm</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,<span style="color:#a6e22e">fmt</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">.3</span><span style="color:#a6e22e">f</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">annot</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">mask</span>=<span style="color:#a6e22e">mask</span>, <span style="color:#a6e22e">annot_kws</span>={<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">size</span><span style="color:#960050;background-color:#1e0010">&#39;</span>:<span style="color:#ae81ff">13</span>}, <span style="color:#a6e22e">vmin</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">vmax</span> = <span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">show</span>()</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike6.JPG"/>
</figure>
</p>
<p><strong>Notes &amp; Conclusions:</strong></p>
<ul>
<li>Count (&ldquo;cnt&rdquo;) is our Y/target variable.</li>
<li>&ldquo;registered&rdquo; and &ldquo;casual&rdquo; are the variables more correlated with &ldquo;cnt&rdquo; which is expected since the sum of both equal &ldquo;cnt&rdquo;. These 2 variables will be dropped following instructions and also taking into consideration their relation with &ldquo;cnt&rdquo;.</li>
<li>&ldquo;temp&rdquo; &amp; &ldquo;atemp&rdquo; are strongly correlated, which is also expected since they measure feeling temperature and temperature. We will drop the value with least explanatory power. They have around 40% correlation with &ldquo;cnt.</li>
<li>Humidity (&ldquo;hum&rdquo;) is the only numerical variable with negative correlation with &ldquo;cnt&rdquo; with a value around -32% (blue color).</li>
</ul>
<h3 id="14-giving-insights-on-what-seems-relevant-for-prediction-and-what-does-not">1.4. Giving insights on what seems relevant for prediction and what does not</h3>
<p>By looking at the correlation heatmap above we already saw some variables with around 40% (excluding &ldquo;casual&rdquo; and &ldquo;registered&rdquo;) which can show already some relevance for prediction.</p>
<p>We could also check iteratively below the relation of each numerical variable with our target &ldquo;cnt&rdquo; in a scatter plot (which also includes our initially defined outliers from variable num1 represented in orange). A more detailed analysis of outliers will be made later.</p>
<ul>
<li>&ldquo;hr&rdquo; we see clearly differences in bike rentals depending on the hour.</li>
<li>&ldquo;windspeed&rdquo; although showed the lowest correlation with &ldquo;cnt&rdquo; at around 9%, we can see if &ldquo;windspeed&rdquo; is above 0.6 there are almost no bike rentals.</li>
</ul>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">Column_Y</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>), <span style="color:#a6e22e">Column_X</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>))
 <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">out_graph</span>(<span style="color:#a6e22e">Column_Y</span>, <span style="color:#a6e22e">Column_X</span>):
   <span style="color:#a6e22e">lower</span>, <span style="color:#a6e22e">upper</span> = <span style="color:#a6e22e">outlier</span>(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>], <span style="color:#ae81ff">1.5</span>)
   <span style="color:#a6e22e">outliers</span> = <span style="color:#a6e22e">df</span>[(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>] &gt; <span style="color:#a6e22e">upper</span>) | (<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>] &lt; <span style="color:#a6e22e">lower</span>)]
   <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">scatterplot</span>(<span style="color:#a6e22e">x</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_X</span>], <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>])
   <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">scatterplot</span>(<span style="color:#a6e22e">x</span> = <span style="color:#a6e22e">outliers</span>[<span style="color:#a6e22e">Column_X</span>], <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">outliers</span>[<span style="color:#a6e22e">Column_Y</span>])</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike7.JPG"/>
</figure>
</p>
<p>In the next section we will perform feature engineering tranforming these initial variables and creating new ones, trying to extract more information and achieving higher relation with our target variable.</p>
<h2 id="part-2-data-engineering-1">Part 2: Data Engineering</h2>
<h3 id="21-discussion-on-missing-values-and-outliers">2.1. Discussion on missing values and outliers</h3>
<p>Below we found 100 missing values in 4 variables and 99 missing values in 1 variable.</p>
<p>If there&rsquo;s no discernable pattern causing the nulls, we know this is time series data therefore we can impute with the values of neighbours. Although there don&rsquo;t seem to be large gaps neither correlation between missing variables. Therefore we are using the method &ldquo;forward fill&rdquo; to propagate last valid observations forward.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">fillna</span>(<span style="color:#a6e22e">method</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">ffill</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">inplace</span>=<span style="color:#a6e22e">True</span>)</code></pre></div>
<p>It’s often a good idea to detect outliers. Outliers can result in a less accurate model. We define a function to classificate as outliers in the beginning of our notebook (copied below) using the IQR technique (interquartile range). We will show the outliers visually and decide on removing them or not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">def</span> <span style="color:#a6e22e">outlier</span>(<span style="color:#a6e22e">col</span>, <span style="color:#a6e22e">n</span>):

    <span style="color:#a6e22e">IQR</span> = <span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">quantile</span>(<span style="color:#ae81ff">.75</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">quantile</span>(<span style="color:#ae81ff">.25</span>)

    <span style="color:#a6e22e">upper</span> = <span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">quantile</span>(<span style="color:#ae81ff">.75</span>) <span style="color:#f92672">+</span> (<span style="color:#a6e22e">n</span><span style="color:#f92672">*</span><span style="color:#a6e22e">IQR</span>)

    <span style="color:#a6e22e">lower</span> = <span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">quantile</span>(<span style="color:#ae81ff">.25</span>) <span style="color:#f92672">-</span> (<span style="color:#a6e22e">n</span><span style="color:#f92672">*</span><span style="color:#a6e22e">IQR</span>)

    print(<span style="color:#e6db74">&#34;Percent Outliers:&#34;</span>, <span style="color:#e6db74">&#34;{:.2%}&#34;</span>.<span style="color:#a6e22e">format</span>( ( len(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">col</span> &gt; <span style="color:#a6e22e">upper</span>]) <span style="color:#f92672">+</span> len(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">col</span> &lt; <span style="color:#a6e22e">lower</span>]) ) <span style="color:#f92672">/</span> len(<span style="color:#a6e22e">df</span>) ) )

    print(<span style="color:#e6db74">&#34;Percent Low Outliers:&#34;</span>, <span style="color:#e6db74">&#34;{:.2%}&#34;</span>.<span style="color:#a6e22e">format</span>( len(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">col</span> &lt; <span style="color:#a6e22e">lower</span>]) <span style="color:#f92672">/</span> len(<span style="color:#a6e22e">df</span>) ) )

    print(<span style="color:#e6db74">&#34;Percent High Outliers:&#34;</span>, <span style="color:#e6db74">&#34;{:.2%}&#34;</span>.<span style="color:#a6e22e">format</span>( len(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">col</span> &gt; <span style="color:#a6e22e">upper</span>]) <span style="color:#f92672">/</span> len(<span style="color:#a6e22e">df</span>) ) )

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lower</span>, <span style="color:#a6e22e">upper</span></code></pre></div>
<p>For each column we had a look at the Box Plot, Histogram and Scatter Plot with our index variable &ldquo;instant&rdquo;. Below our conclusions on outliers (calculated with the previous function):</p>
<p><em><strong>Windspeed column</strong></em></p>
<p>Below we can see we have a few high &ldquo;outliers&rdquo;, but overall they make up only 1.97% of the dataset. These seem like natural expected features within the dataset, and it makes sense that windspeed is normally mild but might be much higher during bad weather. On manual inspection data does not seem abnormal. Instances of high outliers are physically close to eachother in time, which makes sense given high windspeed (like a gust) will continue for a few seconds before subsiding. Does not appear to be sensor error, because in that case if we plot these values over time we would expect to see them clustered together.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">column_name</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>))
<span style="color:#a6e22e">def</span> <span style="color:#a6e22e">out_graph</span>(<span style="color:#a6e22e">column_name</span>):
      <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">boxplot</span>(<span style="color:#a6e22e">x</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">column_name</span>])
      <span style="color:#a6e22e">lower</span>, <span style="color:#a6e22e">upper</span> = <span style="color:#a6e22e">outlier</span>(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">column_name</span>], <span style="color:#ae81ff">1.5</span>)

<span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">Column</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>))
<span style="color:#a6e22e">def</span> <span style="color:#a6e22e">plot_hist</span>(<span style="color:#a6e22e">Column</span>):
  <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">distplot</span>(<span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column</span>], <span style="color:#a6e22e">kde</span>=<span style="color:#a6e22e">True</span>)

<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">reset_index</span>(<span style="color:#a6e22e">inplace</span>=<span style="color:#a6e22e">True</span>)
<span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">interact</span>(<span style="color:#a6e22e">Column_Y</span> = <span style="color:#a6e22e">ipw</span>.<span style="color:#a6e22e">Dropdown</span>(<span style="color:#a6e22e">options</span> = <span style="color:#a6e22e">num_cols</span>))
<span style="color:#a6e22e">def</span> <span style="color:#a6e22e">out_graph</span>(<span style="color:#a6e22e">Column_Y</span>):
      <span style="color:#a6e22e">lower</span>, <span style="color:#a6e22e">upper</span> = <span style="color:#a6e22e">outlier</span>(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>], <span style="color:#ae81ff">1.5</span>)
      <span style="color:#a6e22e">outliers</span> = <span style="color:#a6e22e">df</span>[(<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>] &gt; <span style="color:#a6e22e">upper</span>) | (<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>] &lt; <span style="color:#a6e22e">lower</span>)]
      <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">scatterplot</span>(<span style="color:#a6e22e">x</span> = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;instant&#34;</span>], <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">Column_Y</span>])
      <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">scatterplot</span>(<span style="color:#a6e22e">x</span> = <span style="color:#a6e22e">outliers</span>[<span style="color:#e6db74">&#34;instant&#34;</span>], <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">outliers</span>[<span style="color:#a6e22e">Column_Y</span>])</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike9.JPG"/>
</figure>
</p>
<h3 id="22-treatment-of-text-and-date-features">2.2. Treatment of text and date features</h3>
<h4 id="weather-situation-treatment">Weather situation treatment</h4>
<p>The only text variable we have is &ldquo;weathersit&rdquo;. We will divide it into 2 different categories: good weather and bad weather.</p>
<p>We see it was good weather in around 92% of the observations. Later this variable will be transformed in a binary variable (0,1) for modelling purposes.</p>
<p>In both graphs, we find that the distribution of our observations depending on the weather conditions and we see that the number of bikes rented when there is &ldquo;bad&rdquo; weather is lower than when the weather is considered &ldquo;good&rdquo;.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">bad_weather</span> = [<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Light</span> <span style="color:#a6e22e">Snow</span>, <span style="color:#a6e22e">Light</span> <span style="color:#a6e22e">Rain</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Thunderstorm</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Scattered</span> <span style="color:#a6e22e">clouds</span>, <span style="color:#a6e22e">Light</span> <span style="color:#a6e22e">Rain</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Scattered</span> <span style="color:#a6e22e">clouds</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,
               <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Heavy</span> <span style="color:#a6e22e">Rain</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Ice</span> <span style="color:#a6e22e">Pallets</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Thunderstorm</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Mist</span>, <span style="color:#a6e22e">Snow</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Fog</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
              ]

<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] = [<span style="color:#e6db74">&#34;Bad Weather&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">bad_weather</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Good Weather&#34;</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">weathersit</span>.<span style="color:#a6e22e">values</span>]

<span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>].<span style="color:#a6e22e">value_counts</span>()
<span style="color:#a6e22e">percent</span> = <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>].<span style="color:#a6e22e">value_counts</span>(<span style="color:#a6e22e">normalize</span> = <span style="color:#a6e22e">True</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">2</span>)
print(<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">percent</span>], <span style="color:#a6e22e">axis</span> = <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">keys</span>=[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Counts</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Percentage</span> (<span style="color:#f92672">%</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>]))
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))

<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">boxenplot</span>(<span style="color:#a6e22e">data</span> = <span style="color:#a6e22e">df</span>, <span style="color:#a6e22e">x</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,<span style="color:#a6e22e">y</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">cnt</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">title</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Bike</span> <span style="color:#a6e22e">rides</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">Good</span> <span style="color:#a6e22e">Weather</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">Bad</span> <span style="color:#a6e22e">Weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>);

<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">pointplot</span>(<span style="color:#a6e22e">x</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hr</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">y</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">cnt</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">hue</span> = <span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weather</span><span style="color:#960050;background-color:#1e0010">&#39;</span>])</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike10.JPG"/>
</figure>
</p>
<h4 id="date-treatment">Date treatment</h4>
<p>The column that we have for the date is datetime type. From this variable we will extract 5 new variables: the year, the month, the day, the day of the week and the day of the year.</p>
<p>The differences observed in &ldquo;dayofweek&rdquo; graph will give origin of our next new variable &ldquo;workday&rdquo;.</p>
<p>The 1st graph shows the distribution by hour depending on the year. Year 2012 is represented by the orange line and 2011 by the blue one. They follow a very similar distribution if we filter by hour and count, but the number of bikes rented, clearly increased in 2012.</p>
<p>The 2nd graph shows the number of bikes rented by hour and also by day of the week. We find a very similar distribution in all the days of the week from Monday to Friday(0-5) and a very similiar distribution during the weekends (6 and 7). We can observe different time frames depending if is weekday or weekend, that is why we will dive deeper and will take a better look at it, plotting a new graph depending if is weekend or not after the creation of a new variable &ldquo;workday&rdquo; which will also include holidays.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;year&#34;</span>] = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span>.<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">year</span>
<span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;month&#34;</span>] = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span>.<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">month</span>
<span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;day&#34;</span>] = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span>.<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">day</span>
<span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;dayofweek&#34;</span>] = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span>.<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">dayofweek</span> <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">to</span> <span style="color:#a6e22e">know</span> <span style="color:#a6e22e">working</span> <span style="color:#a6e22e">day</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">not</span>: <span style="color:#a6e22e">monday</span>(<span style="color:#ae81ff">0</span>)<span style="color:#f92672">-</span><span style="color:#a6e22e">friday</span>(<span style="color:#ae81ff">4</span>)
<span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;dayofyear&#34;</span>]= <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span>.<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">dayofyear</span>

<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">pointplot</span>(<span style="color:#a6e22e">x</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hr</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">y</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">cnt</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">hue</span> = <span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">year</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">ax11</span>)
<span style="color:#a6e22e">ax11</span>.<span style="color:#a6e22e">set_title</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Graph</span> <span style="color:#ae81ff">1</span>:<span style="color:#a6e22e">The</span> <span style="color:#a6e22e">influence</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">hour</span> (<span style="color:#a6e22e">year</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>)

<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">pointplot</span>(<span style="color:#a6e22e">x</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hr</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">y</span>=<span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">cnt</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">hue</span> = <span style="color:#a6e22e">df</span>[<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">dayofweek</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] , <span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">ax12</span>)
<span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">set_title</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Graph</span> <span style="color:#ae81ff">2</span>: <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">influence</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">hour</span> (<span style="color:#a6e22e">dayofweek</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike11.JPG"/>
</figure>
</p>
<p>As we already know, the total number of usered are divided in two categories: registered and casual users.</p>
<p>We created a barplot to see the registered users and another one with casual users per day of the week.</p>
<p>We notice how Saturday and Sundays are the days in which we have less registered users. This makes sense as there are many registered users that take the bike to work.</p>
<p>When we look at the casual users, we observe the opposite. We can slightly start to see the increase on Friday but the number of casual users is much higher during the weekends than during the weekdays. People that rent during the weekends probably do it more as a hobbie instead of as a routine.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">barplot</span>(<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dayofweek</span>,<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">registered</span>, <span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">ax11</span>)
<span style="color:#a6e22e">ax11</span>.<span style="color:#a6e22e">set_title</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">influence</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">day</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">week</span> (<span style="color:#a6e22e">Registered</span> <span style="color:#a6e22e">Users</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>)

<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">barplot</span>(<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dayofweek</span>,<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">casual</span>, <span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">ax12</span>)
<span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">set_title</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">influence</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">day</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">week</span> (<span style="color:#a6e22e">Casual</span> <span style="color:#a6e22e">Users</span>)<span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike12.JPG"/>
</figure>
</p>
<h3 id="24-giving-new-insights-on-what-seems-relevant-for-prediction-and-what-does-not">2.4. Giving new insights on what seems relevant for prediction and what does not</h3>
<p>After seing the visializations of our new categories and the effect they have in our target when combining different variables, we will create a new dataframe with all the variables transformed into numeric just to observe the new correlation matrix with all variables.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">df_numeric</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">dtype</span>=<span style="color:#a6e22e">np</span>.<span style="color:#66d9ef">int8</span>)

<span style="color:#a6e22e">numeric_from_df</span> = <span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">include</span>=<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>).<span style="color:#a6e22e">columns</span>.<span style="color:#a6e22e">to_list</span>()
<span style="color:#a6e22e">df_numeric</span> =<span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">numeric_from_df</span>]
<span style="color:#a6e22e">df_numeric</span>[<span style="color:#e6db74">&#34;weather&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;weather&#34;</span>].<span style="color:#a6e22e">astype</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">category</span><span style="color:#960050;background-color:#1e0010">&#39;</span>).<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">codes</span>
<span style="color:#a6e22e">df_numeric</span>[<span style="color:#e6db74">&#34;workday&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;workday&#34;</span>].<span style="color:#a6e22e">astype</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">category</span><span style="color:#960050;background-color:#1e0010">&#39;</span>).<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">codes</span>
<span style="color:#a6e22e">df_numeric</span>[<span style="color:#e6db74">&#34;season&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;season&#34;</span>].<span style="color:#a6e22e">astype</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">category</span><span style="color:#960050;background-color:#1e0010">&#39;</span>).<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">codes</span>
<span style="color:#a6e22e">df_numeric</span>[<span style="color:#e6db74">&#34;time_of_day&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;time_of_day&#34;</span>].<span style="color:#a6e22e">astype</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">category</span><span style="color:#960050;background-color:#1e0010">&#39;</span>).<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">codes</span>

<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">figure</span>(<span style="color:#a6e22e">figsize</span>=(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">font_scale</span>=<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">set_style</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">white</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)

<span style="color:#a6e22e">corr</span> = <span style="color:#a6e22e">df_numeric</span>.<span style="color:#a6e22e">corr</span>()

<span style="color:#a6e22e">mask</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">triu</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">ones_like</span>(<span style="color:#a6e22e">corr</span>, <span style="color:#a6e22e">dtype</span>=<span style="color:#66d9ef">bool</span>)) <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Generating</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">mask</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">triangle</span>
<span style="color:#a6e22e">sns</span>.<span style="color:#a6e22e">heatmap</span>(<span style="color:#a6e22e">corr</span>, <span style="color:#a6e22e">cmap</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">coolwarm</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,<span style="color:#a6e22e">fmt</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">.3</span><span style="color:#a6e22e">f</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">annot</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">mask</span>=<span style="color:#a6e22e">mask</span>, <span style="color:#a6e22e">annot_kws</span>={<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">size</span><span style="color:#960050;background-color:#1e0010">&#39;</span>:<span style="color:#ae81ff">13</span>}, <span style="color:#a6e22e">vmin</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">vmax</span> = <span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">show</span>()</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike13.JPG"/>
</figure>
</p>
<p>Conclusions:</p>
<ul>
<li>We can see as expected high correlation between &ldquo;dayofyear&rdquo; and &ldquo;month&rdquo; and between &ldquo;dayofweek&rdquo; and &ldquo;workday&rdquo;. Only month and worked will be used in the model from these 4 variables as they correlate more with our target than the other 2 variables.</li>
<li>From the reamining new variables only &ldquo;day&rdquo; will not be used in the model since it shows no relevance.</li>
</ul>
<h3 id="25-use-of-scikit-learn-pipelines-to-perform-transformations">2.5. Use of scikit-learn pipelines to perform transformations</h3>
<p><strong>Preprocessing Pipeline:</strong></p>
<p>Since we have already fill in the missing values, our pipeline will be responsabile for creating a binary column for each category in our categorical variables using &ldquo;OneHotEncoder&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">base_processing</span> = <span style="color:#a6e22e">ColumnTransformer</span>([

                                     (<span style="color:#e6db74">&#34;transform_categorical&#34;</span>, <span style="color:#a6e22e">Pipeline</span>([
                                          (<span style="color:#e6db74">&#34;encode&#34;</span>, <span style="color:#a6e22e">OneHotEncoder</span>(<span style="color:#a6e22e">handle_unknown</span>=<span style="color:#e6db74">&#34;ignore&#34;</span>))
                                     ]), <span style="color:#a6e22e">make_column_selector</span>(<span style="color:#a6e22e">dtype_exclude</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>)),

                                  ], <span style="color:#a6e22e">remainder</span> = <span style="color:#e6db74">&#34;passthrough&#34;</span>)

<span style="color:#a6e22e">base_processing</span></code></pre></div>
<h2 id="part-3-machine-learning-1">Part 3: Machine Learning</h2>
<p><strong>Requirements:</strong></p>
<ul>
<li><strong>Training data:</strong> whole 2011 and first 3 quarters of 2012.</li>
<li><strong>Test data:</strong> 4th quarter of 2012. Do not use it to fit your models!</li>
<li><strong>Target:</strong> total number of users (cnt)</li>
<li><strong>Error metric:</strong> R2 score (scikit-learn&rsquo;s default for regression).</li>
<li><strong>Features to use:</strong> at least the ones present in the data (except for cnt, casual, and registered).</li>
</ul>
<p>After dividing our dataframe in Train and Test following the instructions, we have 15211 rows to train and 2168 to test.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">train</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span> &lt; <span style="color:#e6db74">&#34;2012-10-01&#34;</span>]
<span style="color:#a6e22e">test</span> = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">df</span>.<span style="color:#a6e22e">dteday</span> <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#34;2012-10-01&#34;</span>]

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">train</span> <span style="color:#a6e22e">dataset</span>
<span style="color:#a6e22e">X_train</span> = <span style="color:#a6e22e">train</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#a6e22e">columns</span> = [<span style="color:#e6db74">&#34;cnt&#34;</span>, <span style="color:#e6db74">&#34;casual&#34;</span>, <span style="color:#e6db74">&#34;registered&#34;</span>])
<span style="color:#a6e22e">y_train</span> = <span style="color:#a6e22e">train</span>[<span style="color:#e6db74">&#34;cnt&#34;</span>]

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">test</span> <span style="color:#a6e22e">dataset</span>
<span style="color:#a6e22e">X_test</span> = <span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#a6e22e">columns</span> = [<span style="color:#e6db74">&#34;cnt&#34;</span>, <span style="color:#e6db74">&#34;casual&#34;</span>, <span style="color:#e6db74">&#34;registered&#34;</span>])
<span style="color:#a6e22e">y_test</span> = <span style="color:#a6e22e">test</span>[<span style="color:#e6db74">&#34;cnt&#34;</span>]
print(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">shape</span>)
print(<span style="color:#a6e22e">y_train</span>.<span style="color:#a6e22e">shape</span>)
print(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">shape</span> )
print(<span style="color:#a6e22e">y_test</span>.<span style="color:#a6e22e">shape</span>)

<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">info</span>()</code></pre></div>
<h3 id="31-choosing-sensible-models-linear-and-non-linear">3.1. Choosing sensible models (linear and non-linear)</h3>
<h3 id="31-a-baseline-linear-regression-with-initial-variables">3.1. a) Baseline Linear Regression with Initial Variables</h3>
<p>We start with a simple linear regression model only with 6 initial variables (named &ldquo;parameters&rdquo;) to have it as benchmark. From the initial variables only &ldquo;atemp&rdquo; (due to the already mentioned high correlation with &ldquo;temp&rdquo;) is not included. We took into consideration the requirements saying the features to use were at least the ones present in the data (except for cnt, casual, and registered). Later new features will be added.</p>
<p>To evaluate the models we will use the initially defined function &ldquo;evaluate&rdquo; which computes 3 different measures:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">def</span> <span style="color:#a6e22e">mean_absolute_percentage_error</span>(<span style="color:#a6e22e">y_true</span>, <span style="color:#a6e22e">y_pred</span>):

    <span style="color:#a6e22e">y_true</span>, <span style="color:#a6e22e">y_pred</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">y_true</span>), <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">y_pred</span>)

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">mean</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">abs</span>((<span style="color:#a6e22e">y_true</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">y_pred</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">y_true</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>

<span style="color:#a6e22e">def</span> <span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">test_features</span>, <span style="color:#a6e22e">test_labels</span>):

    print(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Root</span> <span style="color:#a6e22e">Mean</span> <span style="color:#a6e22e">squared</span> <span style="color:#66d9ef">error</span>: <span style="color:#f92672">%</span><span style="color:#ae81ff">.2</span><span style="color:#a6e22e">f</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">mean_squared_error</span>(<span style="color:#a6e22e">test_features</span>, <span style="color:#a6e22e">test_labels</span>,<span style="color:#a6e22e">squared</span> = <span style="color:#a6e22e">False</span>))

    print(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Coefficient</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">determination</span>: <span style="color:#f92672">%</span><span style="color:#ae81ff">.2</span><span style="color:#a6e22e">f</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">%</span><span style="color:#a6e22e">r2_score</span>(<span style="color:#a6e22e">test_features</span>, <span style="color:#a6e22e">test_labels</span>))

    print(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">MAPE</span>: <span style="color:#f92672">%</span><span style="color:#ae81ff">.2</span><span style="color:#a6e22e">f</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">%</span>  <span style="color:#a6e22e">mean_absolute_percentage_error</span>(<span style="color:#a6e22e">test_features</span>, <span style="color:#a6e22e">test_labels</span>))</code></pre></div>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">parameters</span> = [<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">dteday</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hr</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">weathersit</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">temp</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hum</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">windspeed</span><span style="color:#960050;background-color:#1e0010">&#39;</span>] <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">variables</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">include</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">model</span>

<span style="color:#a6e22e">X_train</span> = <span style="color:#a6e22e">train</span>[<span style="color:#a6e22e">parameters</span>]

<span style="color:#a6e22e">model</span> = <span style="color:#a6e22e">Pipeline</span>([
                (<span style="color:#e6db74">&#34;Preprocessing&#34;</span>, <span style="color:#a6e22e">base_processing</span>),
                (<span style="color:#e6db74">&#34;Engine&#34;</span>, <span style="color:#a6e22e">LinearRegression</span>())
                ])

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Fit</span> <span style="color:#a6e22e">Model</span>:
<span style="color:#a6e22e">lm_model</span> = <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X</span> = <span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">y_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>:
<span style="color:#a6e22e">y_hat_train</span> = <span style="color:#a6e22e">lm_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">custom</span> <span style="color:#a6e22e">function</span>
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_train</span>, <span style="color:#a6e22e">y_hat_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_train</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_train</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_train</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Train&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_train</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">left</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike15.JPG"/>
</figure>
</p>
<h3 id="evaluating-the-model-in-the-test-dataset">Evaluating the model in the test dataset.</h3>
<p>Below we can see our predictions are not accurate in the test dataset in comparisson to the actual target values. We can see the deviation of the actual and prediction by looking at the two graphs and also the computed metrics. In order to improve our predictions we must either change our predictor variables, model paramaters or the type of model.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">X_test</span> = <span style="color:#a6e22e">test</span>[<span style="color:#a6e22e">parameters</span>] <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">same</span> <span style="color:#a6e22e">variables</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">trained</span> <span style="color:#a6e22e">model</span>

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>
<span style="color:#a6e22e">y_hat_test</span> = <span style="color:#a6e22e">lm_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Metrics</span>:
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_test</span>,<span style="color:#a6e22e">y_hat_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_test</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_test</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_test</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Test&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_test</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">right</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike17.JPG"/>
</figure>
</p>
<h3 id="31-b-linear-regression-with-new-variables">3.1. b) Linear Regression with New Variables</h3>
<p>We will now add 6 of the new variables we created to the parameters list (as explained in the previous section in the second correlation analysis) and exclude 2 variables &ldquo;dteday&rdquo; and &ldquo;weather_sit&rdquo; since new variables were created from that information. We will run again a regression model with the same sequence to see if it improves, mainly in the test dataset.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Fit</span> <span style="color:#a6e22e">Model</span>:
<span style="color:#a6e22e">parameters</span> = [<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">hr</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,<span style="color:#e6db74">&#34;temp&#34;</span>,<span style="color:#e6db74">&#34;hum&#34;</span>,<span style="color:#e6db74">&#34;windspeed&#34;</span>,<span style="color:#e6db74">&#34;weather&#34;</span>,<span style="color:#e6db74">&#34;year&#34;</span>,<span style="color:#e6db74">&#34;month&#34;</span>, <span style="color:#e6db74">&#34;workday&#34;</span>,<span style="color:#e6db74">&#34;season&#34;</span>,<span style="color:#e6db74">&#34;time_of_day&#34;</span>]

<span style="color:#a6e22e">X_train</span> = <span style="color:#a6e22e">train</span>[<span style="color:#a6e22e">parameters</span>]

<span style="color:#a6e22e">lm_model_2</span> = <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X</span> = <span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">y_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>:
<span style="color:#a6e22e">y_hat_train</span> = <span style="color:#a6e22e">lm_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">custom</span> <span style="color:#a6e22e">function</span>
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_train</span>, <span style="color:#a6e22e">y_hat_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_train</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_train</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_train</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Train&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_train</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">left</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike18.JPG"/>
</figure>
</p>
<h3 id="evaluating-the-model-in-the-test-dataset-1">Evaluating the model in the test dataset.</h3>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">X_test</span> = <span style="color:#a6e22e">test</span>[<span style="color:#a6e22e">parameters</span>]

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>
<span style="color:#a6e22e">y_hat_test</span> = <span style="color:#a6e22e">lm_model_2</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Metrics</span>:
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_test</span>,<span style="color:#a6e22e">y_hat_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_test</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_test</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_test</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Test&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_test</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">right</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike19.JPG"/>
</figure>
</p>
<p>We can see above that both the train and the test metrics improved compared with the baseline model, being the improvement in the test metrics even of higher magnitude than the train metrics. We are happy that our new variables improved the model, but still we have seen the data does not follow a linear trend so we will now look for a non-liner model using the same variables.</p>
<h3 id="31-c-baseline-random-forrest">3.1. c) Baseline Random Forrest</h3>
<p>Our data has a non-linear shape and the linear model cannot capture the non-linear features. Therefore we will now implemenrt a Random Forest (non-linear) model using the same 10 variables used in the last linear regression model.</p>
<p>Random forest is a type of supervised machine learning algorithm based on ensemble learning, which is a type of learning where are joined different types of algorithms or same algorithm multiple times to form a more powerful prediction model. The random forest algorithm combines multiple algorithm of the same type i.e. multiple decision trees, resulting in a forest of trees, hence the name &ldquo;Random Forest&rdquo;. The random forest algorithm can be used for both regression and classification tasks.</p>
<p>We will be using the default paramaters of Random Forest as a benchmark to compare hyperparameter tuning and feature selections for the succeding Random Forest models.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">model</span> = <span style="color:#a6e22e">Pipeline</span>([
                (<span style="color:#e6db74">&#34;Preprocessing&#34;</span>, <span style="color:#a6e22e">base_processing</span>),
                (<span style="color:#e6db74">&#34;Engine&#34;</span>, <span style="color:#a6e22e">RandomForestRegressor</span>( <span style="color:#a6e22e">n_jobs</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">random_state</span> = <span style="color:#ae81ff">42</span>))
                ])

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Transform</span> <span style="color:#a6e22e">Data</span>:
<span style="color:#a6e22e">base_processing</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X</span> = <span style="color:#a6e22e">X_train</span>)


<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Fit</span> <span style="color:#a6e22e">Model</span>:
<span style="color:#a6e22e">RF_model</span> = <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X</span> = <span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">y_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>:
<span style="color:#a6e22e">y_hat_train</span> = <span style="color:#a6e22e">RF_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_train</span>)


<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">custom</span> <span style="color:#a6e22e">function</span>
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_train</span>, <span style="color:#a6e22e">y_hat_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_train</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_train</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_train</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_train</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Train&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_train</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">left</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike20.JPG"/>
</figure>
</p>
<h3 id="evaluating-the-model-in-the-test-dataset-2">Evaluating the model in the test dataset.</h3>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>:
<span style="color:#a6e22e">y_hat_test</span> = <span style="color:#a6e22e">RF_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">custom</span> <span style="color:#a6e22e">function</span>
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_test</span>, <span style="color:#a6e22e">y_hat_test</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Plot</span> <span style="color:#a6e22e">Outputs</span>:
<span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">axes</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">figsize</span> = (<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">ax11</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_test</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">X_test</span>.<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">y_hat_test</span>, <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, <span style="color:#a6e22e">s</span> = <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">72</span>)
<span style="color:#a6e22e">ax12</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplot</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_test</span>.<span style="color:#a6e22e">to_numpy</span>()).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Test&#34;</span>, <span style="color:#a6e22e">color</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">blue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">Series</span>(<span style="color:#a6e22e">y_hat_test</span>).<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">ax</span> =<span style="color:#a6e22e">ax12</span> , <span style="color:#a6e22e">label</span> = <span style="color:#e6db74">&#34;Prediction&#34;</span>,  <span style="color:#a6e22e">color</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">red</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)
<span style="color:#a6e22e">legend</span> = <span style="color:#a6e22e">ax12</span>.<span style="color:#a6e22e">legend</span>(<span style="color:#a6e22e">loc</span>=<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">upper</span> <span style="color:#a6e22e">right</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike21.JPG"/>
</figure>
</p>
<p>As expected, we can see that our baseline Random Forest model did not do as well in the test dataset as in the train dataset. However, it has outperformed both linear regression models.</p>
<h3 id="32-tuning-model-parameters-with-validation">3.2. Tuning model parameters with validation</h3>
<p>Using &ldquo;grid_search&rdquo; to find the best compbinations of parameters for the Random Forest Model.</p>
<p>Random forest important paramaters:</p>
<ul>
<li>bootstrap = method for sampling data points (with or without replacement)</li>
<li>max_depth = max number of levels in each decision tree</li>
<li>min_samples_leaf = min number of data points allowed in a leaf node</li>
<li>min_samples_split = min number of data points placed in a node before the node is split</li>
<li>n_estimators - number of trees in the foreset</li>
<li>max_features = max number of features considered for splitting a node</li>
</ul>
<p>For the purpose of this experiment we limit our model to five parameters. As we have limited amount of time and limited amount of processing power, we would like to choose those paramaters that will prevent overfitting.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">parameter</span> <span style="color:#a6e22e">grid</span> <span style="color:#a6e22e">based</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">results</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">random</span> <span style="color:#a6e22e">search</span>
<span style="color:#a6e22e">rf_param_grid</span> = {
    <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">bootstrap</span><span style="color:#960050;background-color:#1e0010">&#39;</span>: [<span style="color:#a6e22e">True</span>],
    <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">max_depth</span><span style="color:#960050;background-color:#1e0010">&#39;</span>: [<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>],
    <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">min_samples_leaf</span><span style="color:#960050;background-color:#1e0010">&#39;</span> : [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],
    <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">min_samples_split</span><span style="color:#960050;background-color:#1e0010">&#39;</span> : [<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">12</span>],
    <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">n_estimators</span><span style="color:#960050;background-color:#1e0010">&#39;</span>: [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>]
}

<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">based</span> <span style="color:#a6e22e">model</span>
<span style="color:#a6e22e">rf</span> = <span style="color:#a6e22e">RandomForestRegressor</span>(<span style="color:#a6e22e">random_state</span> = <span style="color:#ae81ff">42</span>, <span style="color:#a6e22e">n_jobs</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)

<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Instantiate</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">grid</span> <span style="color:#a6e22e">search</span> <span style="color:#a6e22e">model</span>
<span style="color:#a6e22e">grid_search</span> = <span style="color:#a6e22e">GridSearchCV</span>( <span style="color:#a6e22e">estimator</span> = <span style="color:#a6e22e">rf</span>, <span style="color:#a6e22e">param_grid</span> = <span style="color:#a6e22e">rf_param_grid</span> ,<span style="color:#a6e22e">cv</span> = <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">n_jobs</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)

<span style="color:#a6e22e">grid_search</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">base_processing</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X_train</span>), <span style="color:#a6e22e">y_train</span>)

<span style="color:#a6e22e">grid_search</span>.<span style="color:#a6e22e">best_params_</span></code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike22.JPG"/>
</figure>
</p>
<h3 id="33-obtaining-accurate-predictions-in-test">3.3. Obtaining accurate predictions in test</h3>
<p>We will run again the Random Forest model, now with the best parameters previously selected by the cross validation. We will see the results very similar to the previous Random Forest model.</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">model_best_rf</span> = <span style="color:#a6e22e">Pipeline</span>([
                (<span style="color:#e6db74">&#34;Preprocessing&#34;</span>, <span style="color:#a6e22e">base_processing</span>),
                (<span style="color:#e6db74">&#34;Engine&#34;</span>, <span style="color:#a6e22e">RandomForestRegressor</span>(<span style="color:#a6e22e">n_jobs</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">random_state</span> = <span style="color:#ae81ff">42</span>,
    <span style="color:#a6e22e">bootstrap</span>= <span style="color:#a6e22e">True</span> ,
    <span style="color:#a6e22e">max_depth</span> =  <span style="color:#ae81ff">20</span>,
    <span style="color:#a6e22e">min_samples_leaf</span> = <span style="color:#ae81ff">1</span>,
    <span style="color:#a6e22e">min_samples_split</span> =  <span style="color:#ae81ff">8</span>,
    <span style="color:#a6e22e">n_estimators</span> =  <span style="color:#ae81ff">6</span>))
                ])

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Fit</span> <span style="color:#a6e22e">Model</span>:
<span style="color:#a6e22e">RF_model_1</span> = <span style="color:#a6e22e">model_best_rf</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X</span> = <span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y</span> = <span style="color:#a6e22e">y_train</span>)

<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">Predict</span>:
<span style="color:#a6e22e">y_hat_test</span> = <span style="color:#a6e22e">RF_model_1</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_test</span>)


<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">custom</span> <span style="color:#a6e22e">function</span>
<span style="color:#a6e22e">evaluate</span>(<span style="color:#a6e22e">y_test</span>, <span style="color:#a6e22e">y_hat_test</span>)</code></pre></div>
<figure><img src="https://pedrolousantos.github.io/Pedro_Portfolio/images/bike23.JPG"/>
</figure>
</p>
<p>By adding more trees to our Random Forrest decreases the error measures in a marginally less of an effect on our train dataset (as expected) but does not affect our predictions for the test dataset.</p>
<h3 id="final-insights">Final insights</h3>
<p>Previously, the linear regression model showed an improvement with the inclusion of the new variables we created in our feature engineering section after a deep analysis of the data.</p>
<p>Finally, our 2 Random Forest models, before tuning parameters and after tuning parameters, showed a coefficient of determination of 0.85 and 0.84 respectively in the test dataset and a root mean squared error of 77.97 and 79.67 respectively in the test dataset. Therefore, also by looking at the plots above, we are happy to say our variables and our models were able to do a good prediction of our target variable.</p>
<p>The Jupyter Notebook can be found at: <a href="https://github.com/pedrolousantos/Python_Course-Bike_Sharing_Prediction">https://github.com/pedrolousantos/Python_Course-Bike_Sharing_Prediction</a></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://pedrolousantos.github.io/Pedro_Portfolio/" >
    &copy;  Main Page 2021 
  </a>
    <div>







<a href="https://www.linkedin.com/in/pedrolousantos" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/pedrolousantos" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>







</div>
  </div>
</footer>

  </body>
</html>
